<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Vector GAN | Ivan üá∫üá¶ Puhachov </title> <meta name="author" content="Ivan üá∫üá¶ Puhachov"> <meta name="description" content="Training GAN to generate vector images."> <meta name="keywords" content="geometry, graphics, phd, montreal, computer graphics"> <meta property="og:site_name" content="Ivan üá∫üá¶ Puhachov"> <meta property="og:type" content="website"> <meta property="og:title" content="Ivan üá∫üá¶ Puhachov | Vector GAN"> <meta property="og:url" content="https://puhachov.xyz/projects/vector_gan/"> <meta property="og:description" content="Training GAN to generate vector images."> <meta property="og:image" content="/assets/img/prof_pic.jpg"> <meta property="og:locale" content="en"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="Vector GAN"> <meta name="twitter:description" content="Training GAN to generate vector images."> <meta name="twitter:image" content="/assets/img/prof_pic.jpg"> <meta name="twitter:site" content="@ivanpuhachov"> <meta name="twitter:creator" content="@ivanpuhachov"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%8D%BF&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://puhachov.xyz/projects/vector_gan/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?bf50d6d9dd867d3e0f3b0add94449649"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Vector GAN",
            "description": "Training GAN to generate vector images.",
            "published": "May 15, 2021",
            "authors": [
              
              {
                "author": "Ivan Puhachov",
                "authorURL": "https://puhachov.xyz",
                "affiliations": [
                  {
                    "name": "UdeM, Canada",
                    "url": ""
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Ivan¬†</span> üá∫üá¶¬† Puhachov </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">research </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Vector GAN</h1> <p>Training GAN to generate vector images.</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#tldr">TLDR</a> </div> <div> <a href="#motivation">Motivation</a> </div> <div> <a href="#related-work">Related work</a> </div> <div> <a href="#experiments">Experiments</a> </div> <div> <a href="#dataset">Dataset</a> </div> <div> <a href="#gan-architectures">GAN architectures</a> </div> <div> <a href="#evaluation">Evaluation</a> </div> <div> <a href="#results">Results</a> </div> <div> <a href="#latent-space-interpolation">Latent space interpolation</a> </div> </nav> </d-contents> <h3 id="tldr">TLDR</h3> <p>We trained and evaluated several GAN models in a field of vector image generation. The model outputs parameters for a fixed set of drawing primitives (curves and circles), contrary to common ‚Äúraster‚Äù GAN, which generate fixed size image. Despite being trained with 64x64 px image dataset, such model can generate sketches at any resolution, due to using vector graphics.</p> <p>To achieve this we use differentiable rasterizer from <d-cite key="diffsvg"></d-cite> and train different architectures with various datasets.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <img class="img-fluid rounded z-depth-1" src="/assets/img/vector_gan/my_plot_raster.png" data-zoomable=""> </div> </div> <div class="caption"> Typical GAN generates raster image of a fixed resolution. </div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <img class="img-fluid rounded z-depth-1" src="/assets/img/vector_gan/my_plot_vector.png" data-zoomable=""> </div> </div> <div class="caption"> Our GAN generates vector graphics, which can be viewed at any resolution and edited easily without loss of quality. </div> <blockquote> <p><strong>Disclaimer</strong>: This is a project I did for <a href="https://gauthiergidel.github.io/courses/game_theory_ML_2021.html" rel="external nofollow noopener" target="_blank">IFT 6756: Game Theory and ML</a></p> </blockquote> <h3 id="motivation">Motivation</h3> <p>Vector graphics allows for editing without loss of quality. It stores images as a collection of primitives (lines, bezier curves, circles, etc.) with corresponding control parameters (color, width, control points).</p> <p>Typical generative models are trained on raster images (image as array), while vector graphics space is non-euclidean and thus more challenging. Several approaches were tried, until finally a differentiable rasterizer proposed in <d-cite key="diffsvg"></d-cite> made it possible to do a direct backpropagation to primitives parameters.</p> <p>In this project we apply differentiable rasterizer from <d-cite key="diffsvg"></d-cite> to experiment with generative art on different datasets, GAN architectures, and create adversarial examples using painting. We show that it may become a nice tool in media art creation, as it connects capable GANs and other neural nets with all the advantages of vector graphics.</p> <p><strong>Transparency</strong>: the referenced paper <d-cite key="diffsvg"></d-cite> already provides the examples of GAN model trained using their rasterizer. The aim of this project was to reproduce their result independently, try another application and new data.</p> <div class="l-gutter"> <img class="img-fluid " src="/assets/img/vector_gan/diffsvg.png" data-zoomable=""> </div> <h3 id="related-work">Related work</h3> <p>Most generative adversarial networks are generating raster images. DoodlerGAN <d-cite key="doodlergan"></d-cite> aimed to replicate human drawings by generating raster body parts.</p> <p>SketchRNN <d-cite key="sketchrnn"></d-cite> modeled drawing as a decision making sequential process and trained seq2seq RNN VAE to generate quick sketches. SVG VAE <d-cite key="svgvae"></d-cite> applies the same approach to model fonts as a sequence of 4 commands, SketchBERT <d-cite key="sketchbert"></d-cite> moved to a next level by training a giant BERT model on the same data. DeepSVG <d-cite key="carlier2020deepsvg"></d-cite> uses transformers to generate SVG control commands for a vider family of svg primitives.</p> <p>Differentiable rasterizer proposed in <d-cite key="diffsvg"></d-cite> allows gradient flow from rendered image to svg parameteres, thus we can optimize svg primitives directly from raster signal. They also showed several application of generative models. Im2Vec <d-cite key="reddy2021im2vec"></d-cite> uses this rasterizer to generate vector graphics from raster examples.</p> <h2 id="experiments">Experiments</h2> <h4 id="dataset">Dataset</h4> <p>We took simple sketches from QuickDraw dataset with categories <code class="language-plaintext highlighter-rouge">apple</code>, <code class="language-plaintext highlighter-rouge">cookie</code>, <code class="language-plaintext highlighter-rouge">donut</code>, <code class="language-plaintext highlighter-rouge">face</code>, <code class="language-plaintext highlighter-rouge">lollipop</code> and 5000 of each category with resolution 64x64. Note that we train a ‚Äúgrayscale‚Äù model to save computations and fit to grayscale dataset, while it is possible to have colored sketches.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <img class="img-fluid rounded z-depth-1" src="/assets/img/vector_gan/data.png" data-zoomable=""> </div> </div> <div class="caption"> Dataset examples from QuickDraw data. </div> <p>We also tried training on more complex classes like <code class="language-plaintext highlighter-rouge">owl</code> or another dataset Creative Birds, but due to computational limitations our model did not converge to any good looking results.</p> <h4 id="gan-architectures">GAN architectures</h4> <p>Generator takes as input a latent vector $z \in \mathbb{R}^{100}$ and outputs parameters for 16 bezier curves (14 positional parameters + width and alpha) and 5 circles (2 positional parameters + radius + width + alpha). Neural net consists of 4 flat linear layers of dimensions [128, 256, 512, 1024], the last layer is then projected into each parameter family independently. Output parameters is then grouped and passed to differentiable rasterizer to generate image.</p> <p>Discriminator is a convolutional neural network of 6 layers, with LeakyReLU activation. After experiments we ended up using the same discriminator architecture as was proposed in the original paper, as our attempts failed due to discriminator net being too powerful.</p> <p>We implemented and trained the following modifications for training GAN, commonly used in literature.</p> <p>Training of each model took approximately <strong>10 hours</strong> on a single GPU (NVidia RTX2080Ti). Unfortunately, we could not use Google Colab as differentiable rasterizer was not compatible with Colab hardware. Number of experiments was also limited due to high computational costs.</p> <ul> <li> <strong>WGAN</strong> <d-cite key="arjovsky2017wasserstein"></d-cite> makes a critic $K$-Lipschitz by clipping its gradients to stabilize training</li> </ul> \[\omega \leftarrow clip (\omega, -0.01, 0.01)\] <ul> <li> <strong>WGAN-GP</strong> <d-cite key="gulrajani2017improved"></d-cite> forces $K$-Lipschitz by adding a gradient penalty to the loss</li> </ul> \[\hat x \leftarrow \epsilon x_{real} + (1-\epsilon) x_{fake}\] \[loss \leftarrow D(x_{fake}) - D(x_{real}) + \lambda (\| \nabla_{\hat x} D(\hat x) \|_2 - 1)^2\] <ul> <li> <strong>SNGAN</strong> <d-cite key="miyato2018spectral"></d-cite> Force 1-Lipschitz continuity by spectral normalization of critic‚Äôs layers</li> </ul> \[\bar W_{SN} (W) = \frac W {\sigma(W)}\] <ul> <li> <strong>LOGAN</strong> <d-cite key="wu2020logan"></d-cite> More gradient flow to generator by making a latent gradient step $z = z + \Delta z$ before passing image to discriminator</li> </ul> \[g = \frac{\partial D(G(z))}{\partial z}; \; \; \Delta z = \frac {\alpha} {\beta + \| g \|^2} \cdot g\] <p>Unfortunately, LOGAN model did not converge in our experiments - it must be a bug in our code, or a conceptual mistake.</p> <h3 id="evaluation">Evaluation</h3> <p>We evaluated and compared our models using Inception Score <code class="language-plaintext highlighter-rouge">IS</code> and Frechet Inception distance <code class="language-plaintext highlighter-rouge">FID</code>. Inception Score <d-cite key="salimans2016improved"></d-cite> uses pretrained classificator and measures the variety of generated examples through measuring distribution of labels predicted by pretrained classifier. Frechet inception distance <d-cite key="heusel2018gans"></d-cite> measures this variety by comparing feature distribution extracted by classifier on validation set and generated samples:</p> \[\| \mu_{real} - \mu_{fake} \|_2^2 + Trace(\Sigma_{real} + \Sigma_{fake} - 2 (\Sigma_1 \Sigma_2)^{0.5})\] <blockquote> <p>FID score between validation and test subsets is 30.56</p> </blockquote> <h3 id="results">Results</h3> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <img class="img-fluid rounded z-depth-1" src="/assets/img/vector_gan/gen.png" data-zoomable=""> </div> </div> <div class="caption"> Generated data samples. Note that both vector curves and circles are in use here. Images are rasterized to 64x64 resolution for visualization purposes. </div> <p>As for quality scores, neither of the model showed good performance (the scores are far from ground truth FID). Consider the table below.</p> <table> <thead> <tr> <th>Model</th> <th>IS</th> <th>FID</th> </tr> </thead> <tbody> <tr> <td>WGAN</td> <td>1.935</td> <td>94.14</td> </tr> <tr> <td>WGAN-GP</td> <td>1.856</td> <td>101.7</td> </tr> <tr> <td>SN WGAN-GP</td> <td>1.919</td> <td>84.54</td> </tr> <tr> <td>LOGAN NGD</td> <td>1.11</td> <td>208</td> </tr> </tbody> </table> <p>We see that LOGAN is much worse in scores, and indeed the model failed to converge to meaningful results, generating the same repeating pattern. This is known as mode collapse problem. We see no theoretical limitations with using this approach, some hyperparameter tweaking is required to make it work, as we spent a lot of time finding the correct batch size and learning rate to make other models work.</p> <p>As for Wasserstein GANs, they showed good convergence and results, but results are far from perfect both visually and qualitatively. We did not achieve desired FID score of 30 (as between validation and test subsets). But again, we assume that it is only the matter of longer training.</p> <blockquote> <p>Differentiable rasterization is computationally expensive operation and thus GAN with vector graphics takes approximately 10 times more time to converge. Unfortunately, we could not speed up this process as increasing batch size breaks the training dynamics.</p> </blockquote> <h4 id="latent-space-interpolation">Latent space interpolation</h4> <p>As generator‚Äôs output now has a direct meaning (it is connected to control parameters of underlying primitives), opposed to raster GAN‚Äôs, which generate pixel colors directly, we see extracting meaningful directions in a latent space as promising direction of future research.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <img class="img-fluid rounded z-depth-1" src="/assets/img/vector_gan/inter1.png" data-zoomable=""> </div> </div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <img class="img-fluid rounded z-depth-1" src="/assets/img/vector_gan/inter2.png" data-zoomable=""> </div> </div> <div class="caption"> Latent space interpolation examples. </div> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/2021-vectorgan.bib"></d-bibliography> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> ¬© Copyright 2024 Ivan üá∫üá¶ Puhachov. Powered by <a href="http://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>